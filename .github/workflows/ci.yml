name: CI

# CI runs on branch pushes and PRs, but NOT on tags.
#
# Why no tag trigger?
# - Auto Release workflow (auto-release.yml) waits for CI to pass on main
#   before creating a tag
# - The tag contains the exact same code that just passed CI on main
# - Running CI again on the tag is redundant
# - Release workflow (release.yml) trusts this guarantee
#
# Quality guarantee chain:
#   push to main → CI passes → Auto Release creates tag → Release publishes
#
on:
  push:
    branches: ['**']
    # Note: tags intentionally excluded - see comment above
  pull_request:
    branches: [main]

# Prevent duplicate runs: cancel in-progress runs for same branch
# When a PR is open, only run the pull_request event (skip the push)
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  # Validate shell scripts
  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install shellcheck
        run: sudo apt-get install -y shellcheck

      - name: Run shellcheck on hooks
        run: |
          # Find all .sh files in hooks/ and run shellcheck
          find hooks -name "*.sh" -type f -exec shellcheck {} +

  # Success job - only runs if all parallel jobs pass
  ci-success:
    runs-on: ubuntu-latest
    needs: [shellcheck]
    steps:
      - name: CI passed
        run: echo "All CI checks passed!"
